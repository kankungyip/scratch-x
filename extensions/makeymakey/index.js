const{ArgumentType,BlockType}=Scratch,Cast=Scratch.Util.Cast,blockIconURI="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0MCA0MCI+PHN0eWxlPi5zdDJ7ZmlsbDpyZWR9LnN0M3tmaWxsOiNlMGUwZTB9LnN0NHtmaWxsOm5vbmU7c3Ryb2tlOiM2NjY7c3Ryb2tlLXdpZHRoOi41O3N0cm9rZS1taXRlcmxpbWl0OjEwfTwvc3R5bGU+PHBhdGggZD0iTTM1IDI4SDVhMSAxIDAgMCAxLTEtMVYxMmMwLS42LjQtMSAxLTFoMzBjLjUgMCAxIC40IDEgMXYxNWMwIC41LS41IDEtMSAxeiIgZmlsbD0iI2ZmZiIgaWQ9IkxheWVyXzYiLz48ZyBpZD0iTGF5ZXJfNCI+PHBhdGggY2xhc3M9InN0MiIgZD0iTTQgMjVoMzJ2Mi43SDR6TTEzIDI0aC0yLjJhMSAxIDAgMCAxLTEtMXYtOS43YzAtLjYuNC0xIDEtMUgxM2MuNiAwIDEgLjQgMSAxVjIzYzAgLjYtLjUgMS0xIDF6Ii8+PHBhdGggY2xhc3M9InN0MiIgZD0iTTYuMSAxOS4zdi0yLjJjMC0uNS40LTEgMS0xaDkuN2MuNSAwIDEgLjUgMSAxdjIuMmMwIC41LS41IDEtMSAxSDcuMWExIDEgMCAwIDEtMS0xeiIvPjxjaXJjbGUgY2xhc3M9InN0MiIgY3g9IjIyLjgiIGN5PSIxOC4yIiByPSIzLjQiLz48Y2lyY2xlIGNsYXNzPSJzdDIiIGN4PSIzMC42IiBjeT0iMTguMiIgcj0iMy40Ii8+PHBhdGggY2xhc3M9InN0MiIgZD0iTTQuMiAyN2gzMS45di43SDQuMnoiLz48L2c+PGcgaWQ9IkxheWVyXzUiPjxjaXJjbGUgY2xhc3M9InN0MyIgY3g9IjIyLjgiIGN5PSIxOC4yIiByPSIyLjMiLz48Y2lyY2xlIGNsYXNzPSJzdDMiIGN4PSIzMC42IiBjeT0iMTguMiIgcj0iMi4zIi8+PHBhdGggY2xhc3M9InN0MyIgZD0iTTEyLjUgMjIuOWgtMS4yYy0uMyAwLS41LS4yLS41LS41VjE0YzAtLjMuMi0uNS41LS41aDEuMmMuMyAwIC41LjIuNS41djguNGMwIC4zLS4yLjUtLjUuNXoiLz48cGF0aCBjbGFzcz0ic3QzIiBkPSJNNy4yIDE4Ljd2LTEuMmMwLS4zLjItLjUuNS0uNWg4LjRjLjMgMCAuNS4yLjUuNXYxLjJjMCAuMy0uMi41LS41LjVINy43Yy0uMyAwLS41LS4yLS41LS41ek00IDI2aDMydjJINHoiLz48L2c+PGcgaWQ9IkxheWVyXzMiPjxwYXRoIGNsYXNzPSJzdDQiIGQ9Ik0zNS4yIDI3LjlINC44YTEgMSAwIDAgMS0xLTFWMTIuMWMwLS42LjUtMSAxLTFoMzAuNWMuNSAwIDEgLjQgMSAxVjI3YTEgMSAwIDAgMS0xLjEuOXoiLz48cGF0aCBjbGFzcz0ic3Q0IiBkPSJNMzUuMiAyNy45SDQuOGExIDEgMCAwIDEtMS0xVjEyLjFjMC0uNi41LTEgMS0xaDMwLjVjLjUgMCAxIC40IDEgMVYyN2ExIDEgMCAwIDEtMS4xLjl6Ii8+PC9nPjwvc3ZnPg==",KEY_BUFFER_LENGTH=100,SEQUENCE_HAT_TIMEOUT=100,KEY_ID_SPACE="SPACE",KEY_ID_LEFT="LEFT",KEY_ID_RIGHT="RIGHT",KEY_ID_UP="UP",KEY_ID_DOWN="DOWN",SCRATCH_KEY_NAME={[KEY_ID_SPACE]:"space",[KEY_ID_LEFT]:"left arrow",[KEY_ID_UP]:"up arrow",[KEY_ID_RIGHT]:"right arrow",[KEY_ID_DOWN]:"down arrow"};class Scratch3MakeyMakeyBlocks{constructor(){this.keyPressed=this.keyPressed.bind(this),Scratch.emitter.on("KEY_PRESSED",this.keyPressed),this._clearkeyPressBuffer=this._clearkeyPressBuffer.bind(this),Scratch.emitter.on("PROJECT_STOP_ALL",this._clearkeyPressBuffer),this.sequences={},this.keyPressBuffer=[],this.lastKeyPressed=null}get KEY_TEXT_SHORT(){return{[KEY_ID_SPACE]:formatMessage({id:"makeymakey.spaceKey",default:"space",description:"The space key on a computer keyboard."}),[KEY_ID_LEFT]:formatMessage({id:"makeymakey.leftArrowShort",default:"left",description:"Short name for the left arrow key on a computer keyboard."}),[KEY_ID_UP]:formatMessage({id:"makeymakey.upArrowShort",default:"up",description:"Short name for the up arrow key on a computer keyboard."}),[KEY_ID_RIGHT]:formatMessage({id:"makeymakey.rightArrowShort",default:"right",description:"Short name for the right arrow key on a computer keyboard."}),[KEY_ID_DOWN]:formatMessage({id:"makeymakey.downArrowShort",default:"down",description:"Short name for the down arrow key on a computer keyboard."})}}get DEFAULT_SEQUENCES(){return[`${KEY_ID_LEFT} ${KEY_ID_UP} `+KEY_ID_RIGHT,`${KEY_ID_RIGHT} ${KEY_ID_UP} `+KEY_ID_LEFT,KEY_ID_LEFT+" "+KEY_ID_RIGHT,KEY_ID_RIGHT+" "+KEY_ID_LEFT,KEY_ID_UP+" "+KEY_ID_DOWN,KEY_ID_DOWN+" "+KEY_ID_UP,`${KEY_ID_UP} ${KEY_ID_RIGHT} ${KEY_ID_DOWN} `+KEY_ID_LEFT,`${KEY_ID_UP} ${KEY_ID_LEFT} ${KEY_ID_DOWN} `+KEY_ID_RIGHT,`${KEY_ID_UP} ${KEY_ID_UP} ${KEY_ID_DOWN} ${KEY_ID_DOWN} `+`${KEY_ID_LEFT} ${KEY_ID_RIGHT} ${KEY_ID_LEFT} `+KEY_ID_RIGHT]}getInfo(){return{id:"makeymakey",name:"Makey Makey",blockIconURI:blockIconURI,blocks:[{opcode:"whenMakeyKeyPressed",text:formatMessage({id:"makeymakey.whenKeyPressed",default:"when [KEY] key pressed",description:"when a keyboard key is pressed"}),blockType:BlockType.HAT,arguments:{KEY:{type:ArgumentType.STRING,menu:"KEY",defaultValue:KEY_ID_SPACE}}},{opcode:"whenCodePressed",text:formatMessage({id:"makeymakey.whenKeysPressedInOrder",default:"when [SEQUENCE] pressed in order",description:"when a sequence of keyboard keys is pressed in a specific order"}),blockType:BlockType.HAT,arguments:{SEQUENCE:{type:ArgumentType.STRING,menu:"SEQUENCE",defaultValue:this.DEFAULT_SEQUENCES[0]}}}],menus:{KEY:{acceptReporters:!0,items:[{text:formatMessage({id:"makeymakey.spaceKey",default:"space",description:"The space key on a computer keyboard."}),value:KEY_ID_SPACE},{text:formatMessage({id:"makeymakey.upArrow",default:"up arrow",description:"The up arrow key on a computer keyboard."}),value:KEY_ID_UP},{text:formatMessage({id:"makeymakey.downArrow",default:"down arrow",description:"The down arrow key on a computer keyboard."}),value:KEY_ID_DOWN},{text:formatMessage({id:"makeymakey.rightArrow",default:"right arrow",description:"The right arrow key on a computer keyboard."}),value:KEY_ID_RIGHT},{text:formatMessage({id:"makeymakey.leftArrow",default:"left arrow",description:"The left arrow key on a computer keyboard."}),value:KEY_ID_LEFT},{text:"w",value:"w"},{text:"a",value:"a"},{text:"s",value:"s"},{text:"d",value:"d"},{text:"f",value:"f"},{text:"g",value:"g"}]},SEQUENCE:{acceptReporters:!0,items:this.buildSequenceMenu(this.DEFAULT_SEQUENCES)}}}}buildSequenceMenu(e){return e.map(e=>this.getMenuItemForSequenceString(e))}getMenuItemForSequenceString(e){let r=e.split(" ");return{text:(r=r.map(e=>this.KEY_TEXT_SHORT[e])).join(" "),value:e}}whenMakeyKeyPressed(e){e=this.lastKeyPressed===e.KEY;return this.lastKeyPressed=null,e}keyPressed(e){e=(e=e.split(" ")[0]).toUpperCase(),this.lastKeyPressed=e,this.keyPressBuffer.push(e),this.keyPressBuffer.length>KEY_BUFFER_LENGTH&&this.keyPressBuffer.shift();for(const s in this.sequences){var a=this.sequences[s].array;if(!(this.keyPressBuffer.length<a.length)){let r=!1;var t=this.keyPressBuffer.slice(-1*a.length);for(let e=0;e<a.length;e++)a[e]!==t[e]&&(r=!0);r||(this.sequences[s].completed=!0,setTimeout(()=>{this.sequences[s].completed=!1},SEQUENCE_HAT_TIMEOUT))}}}_clearkeyPressBuffer(){this.keyPressBuffer=[]}addSequence(e,r){this.sequences.hasOwnProperty(e)||(this.sequences[e]={array:r,completed:!1})}whenCodePressed(e){var e=Cast.toString(e.SEQUENCE).toUpperCase(),r=e.split(" ");if(!(r.length<2))return this.addSequence(e,r),this.sequences[e].completed}}Scratch.extensions.register(new Scratch3MakeyMakeyBlocks),formatMessage.setup({translations:{en:{"makeymakey.downArrow":"down arrow","makeymakey.downArrowShort":"down","makeymakey.leftArrow":"left arrow","makeymakey.leftArrowShort":"left","makeymakey.rightArrow":"right arrow","makeymakey.rightArrowShort":"right","makeymakey.spaceKey":"space","makeymakey.upArrow":"up arrow","makeymakey.upArrowShort":"up","makeymakey.whenKeyPressed":"when [KEY] key pressed","makeymakey.whenKeysPressedInOrder":"when [SEQUENCE] pressed in order"},"zh-cn":{"makeymakey.downArrow":"↓","makeymakey.downArrowShort":"↓","makeymakey.leftArrow":"←","makeymakey.leftArrowShort":"←","makeymakey.rightArrow":"→","makeymakey.rightArrowShort":"→","makeymakey.spaceKey":"空格","makeymakey.upArrow":"↑","makeymakey.upArrowShort":"↑","makeymakey.whenKeyPressed":"当按下 [KEY] 键","makeymakey.whenKeysPressedInOrder":"当依次按下[SEQUENCE]键时"},"zh-tw":{"makeymakey.downArrow":"向下","makeymakey.downArrowShort":"向下","makeymakey.leftArrow":"向左","makeymakey.leftArrowShort":"向左","makeymakey.rightArrow":"向右","makeymakey.rightArrowShort":"向右","makeymakey.spaceKey":"空白","makeymakey.upArrow":"向上","makeymakey.upArrowShort":"向上","makeymakey.whenKeyPressed":"當 [KEY] 按鈕被按下","makeymakey.whenKeysPressedInOrder":"當 [SEQUENCE] 按鈕被依序按下"}}});