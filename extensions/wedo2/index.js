const{ArgumentType,BlockType}=Scratch,WebBLE=Scratch.IO["WebBLE"],{Base64Util,Cast,Color,MathUtil,RateLimiter}=Scratch.Util,iconURI="data:image/png;base64,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",BLEService={DEVICE_SERVICE:"00001523-1212-efde-1523-785feabcd123",IO_SERVICE:"00004f0e-1212-efde-1523-785feabcd123"},BLECharacteristic={ATTACHED_IO:"00001527-1212-efde-1523-785feabcd123",LOW_VOLTAGE_ALERT:"00001528-1212-efde-1523-785feabcd123",INPUT_VALUES:"00001560-1212-efde-1523-785feabcd123",INPUT_COMMAND:"00001563-1212-efde-1523-785feabcd123",OUTPUT_COMMAND:"00001565-1212-efde-1523-785feabcd123"},BLEBatteryCheckInterval=5e3,BLESendInterval=100,BLESendRateMax=20,WeDo2Device={MOTOR:1,PIEZO:22,LED:23,TILT:34,DISTANCE:35},WeDo2ConnectID={LED:6,PIEZO:5},WeDo2Command={MOTOR_POWER:1,PLAY_TONE:2,STOP_TONE:3,WRITE_RGB:4,SET_VOLUME:255},WeDo2Mode={TILT:0,DISTANCE:0,LED:1},WeDo2Unit={TILT:0,DISTANCE:1,LED:0};class WeDo2Motor{constructor(e,t){this._parent=e,this._index=t,this._direction=1,this._power=100,this._isOn=!1,this._pendingTimeoutId=null,this._pendingTimeoutStartTime=null,this._pendingTimeoutDelay=null,this.startBraking=this.startBraking.bind(this),this.turnOff=this.turnOff.bind(this)}static get BRAKE_TIME_MS(){return 1e3}get direction(){return this._direction}set direction(e){this._direction=e<0?-1:1}get power(){return this._power}set power(e){e=Math.max(0,Math.min(e,100));this._power=0===e?0:30+70/(100/e)}get isOn(){return this._isOn}get pendingTimeoutStartTime(){return this._pendingTimeoutStartTime}get pendingTimeoutDelay(){return this._pendingTimeoutDelay}turnOn(){var e;0!==this._power&&(e=this._parent.generateOutputCommand(this._index+1,WeDo2Command.MOTOR_POWER,[this._power*this._direction]),this._parent.send(BLECharacteristic.OUTPUT_COMMAND,e),this._isOn=!0,this._clearTimeout())}turnOnFor(e){0!==this._power&&(e=Math.max(0,e),this.turnOn(),this._setNewTimeout(this.startBraking,e))}startBraking(){var e;0!==this._power&&(e=this._parent.generateOutputCommand(this._index+1,WeDo2Command.MOTOR_POWER,[127]),this._parent.send(BLECharacteristic.OUTPUT_COMMAND,e),this._isOn=!1,this._setNewTimeout(this.turnOff,WeDo2Motor.BRAKE_TIME_MS))}turnOff(e=!0){var t;0!==this._power&&(t=this._parent.generateOutputCommand(this._index+1,WeDo2Command.MOTOR_POWER,[0]),this._parent.send(BLECharacteristic.OUTPUT_COMMAND,t,e),this._isOn=!1)}_clearTimeout(){null!==this._pendingTimeoutId&&(clearTimeout(this._pendingTimeoutId),this._pendingTimeoutId=null,this._pendingTimeoutStartTime=null,this._pendingTimeoutDelay=null)}_setNewTimeout(e,t){this._clearTimeout();const o=setTimeout(()=>{this._pendingTimeoutId===o&&(this._pendingTimeoutId=null,this._pendingTimeoutStartTime=null,this._pendingTimeoutDelay=null),e()},t);this._pendingTimeoutId=o,this._pendingTimeoutStartTime=Date.now(),this._pendingTimeoutDelay=t}}class WeDo2{constructor(e){Scratch.emitter.on("PROJECT_STOP_ALL",this.stopAll.bind(this)),this._extensionId=e,this._ports=["none","none"],this._motors=[null,null],this._sensors={tiltX:0,tiltY:0,distance:0},this._ble=null,Scratch.extensions.registerPeripheral(e,this),this._rateLimiter=new RateLimiter(BLESendRateMax),this._batteryLevelIntervalId=null,this.reset=this.reset.bind(this),this._onConnect=this._onConnect.bind(this),this._onMessage=this._onMessage.bind(this),this._checkBatteryLevel=this._checkBatteryLevel.bind(this)}get tiltX(){return this._sensors.tiltX}get tiltY(){return this._sensors.tiltY}get distance(){return this._sensors.distance}motor(e){return this._motors[e]}stopAllMotors(){this._motors.forEach(e=>{e&&e.turnOff(!1)})}setLED(e){e=[e>>16&255,e>>8&255,255&e],e=this.generateOutputCommand(WeDo2ConnectID.LED,WeDo2Command.WRITE_RGB,e);return this.send(BLECharacteristic.OUTPUT_COMMAND,e)}setLEDMode(){var e=this.generateInputCommand(WeDo2ConnectID.LED,WeDo2Device.LED,WeDo2Mode.LED,0,WeDo2Unit.LED,!1);return this.send(BLECharacteristic.INPUT_COMMAND,e)}stopLED(){var e=this.generateOutputCommand(WeDo2ConnectID.LED,WeDo2Command.WRITE_RGB,[0,0,0]);return this.send(BLECharacteristic.OUTPUT_COMMAND,e)}playTone(e,t){e=this.generateOutputCommand(WeDo2ConnectID.PIEZO,WeDo2Command.PLAY_TONE,[e,e>>8,t,t>>8]);return this.send(BLECharacteristic.OUTPUT_COMMAND,e)}stopTone(){var e=this.generateOutputCommand(WeDo2ConnectID.PIEZO,WeDo2Command.STOP_TONE);return this.send(BLECharacteristic.OUTPUT_COMMAND,e,!1)}stopAll(){this.isConnected()&&(this.stopTone(),this.stopAllMotors())}scan(){this._ble&&this._ble.disconnect(),this._ble=new WebBLE(this._extensionId,{filters:[{services:[BLEService.DEVICE_SERVICE]}],optionalServices:[BLEService.IO_SERVICE]},this._onConnect,this.reset)}connect(e){this._ble&&this._ble.connectPeripheral(e)}disconnect(){this._ble&&this._ble.disconnect(),this.reset()}reset(){this._ports=["none","none"],this._motors=[null,null],this._sensors={tiltX:0,tiltY:0,distance:0},this._batteryLevelIntervalId&&(clearInterval(this._batteryLevelIntervalId),this._batteryLevelIntervalId=null)}isConnected(){let e=!1;return e=this._ble?this._ble.isConnected():e}send(e,t,o=!0){return!this.isConnected()||o&&!this._rateLimiter.okayToSend()?Promise.resolve():this._ble.write(BLEService.IO_SERVICE,e,Base64Util.uint8ArrayToBase64(t),"base64")}generateOutputCommand(e,t,o=null){let i=[e,t];return i=o?i.concat(o.length).concat(o):i}generateInputCommand(e,t,o,i,r,n){return[1,2,e,t,o,i,0,0,0,r,n?1:0]}_onConnect(){this.setLEDMode(),this.setLED(255),this._ble.startNotifications(BLEService.DEVICE_SERVICE,BLECharacteristic.ATTACHED_IO,this._onMessage),this._batteryLevelIntervalId=setInterval(this._checkBatteryLevel,BLEBatteryCheckInterval)}_onMessage(e){var t=Base64Util.base64ToUint8Array(e);switch(t[0]){case 1:case 2:var o=t[0];0===t[1]?this._clearPort(o):this._registerSensorOrMotor(o,t[3]);break;default:o=t[1],o=this._ports[o-1];o===WeDo2Device.DISTANCE&&(this._sensors.distance=t[2]),o===WeDo2Device.TILT&&(this._sensors.tiltX=t[2],this._sensors.tiltY=t[3])}}_checkBatteryLevel(){this._ble.read(BLEService.DEVICE_SERVICE,BLECharacteristic.LOW_VOLTAGE_ALERT,!1)}_registerSensorOrMotor(e,t){var o;(this._ports[e-1]=t)===WeDo2Device.MOTOR?this._motors[e-1]=new WeDo2Motor(this,e-1):(o=t===WeDo2Device.DISTANCE?"DISTANCE":"TILT",e=this.generateInputCommand(e,t,WeDo2Mode[o],1,WeDo2Unit[o],!0),this.send(BLECharacteristic.INPUT_COMMAND,e),this._ble.startNotifications(BLEService.IO_SERVICE,BLECharacteristic.INPUT_VALUES,this._onMessage))}_clearPort(e){var t=this._ports[e-1];t===WeDo2Device.TILT&&(this._sensors.tiltX=this._sensors.tiltY=0),t===WeDo2Device.DISTANCE&&(this._sensors.distance=0),this._ports[e-1]="none",this._motors[e-1]=null}}const WeDo2MotorLabel={DEFAULT:"motor",A:"motor A",B:"motor B",ALL:"all motors"},WeDo2MotorDirection={FORWARD:"this way",BACKWARD:"that way",REVERSE:"reverse"},WeDo2TiltDirection={UP:"up",DOWN:"down",LEFT:"left",RIGHT:"right",ANY:"any"};class Scratch3WeDo2Blocks{static get EXTENSION_ID(){return"wedo2"}static get TILT_THRESHOLD(){return 15}constructor(){this._peripheral=new WeDo2(Scratch3WeDo2Blocks.EXTENSION_ID)}getInfo(){return{id:Scratch3WeDo2Blocks.EXTENSION_ID,name:"WeDo 2.0",blockIconURI:iconURI,showStatusButton:!0,blocks:[{opcode:"motorOnFor",text:formatMessage({id:"wedo2.motorOnFor",default:"turn [MOTOR_ID] on for [DURATION] seconds",description:"turn a motor on for some time"}),blockType:BlockType.COMMAND,arguments:{MOTOR_ID:{type:ArgumentType.STRING,menu:"MOTOR_ID",defaultValue:WeDo2MotorLabel.DEFAULT},DURATION:{type:ArgumentType.NUMBER,defaultValue:1}}},{opcode:"motorOn",text:formatMessage({id:"wedo2.motorOn",default:"turn [MOTOR_ID] on",description:"turn a motor on indefinitely"}),blockType:BlockType.COMMAND,arguments:{MOTOR_ID:{type:ArgumentType.STRING,menu:"MOTOR_ID",defaultValue:WeDo2MotorLabel.DEFAULT}}},{opcode:"motorOff",text:formatMessage({id:"wedo2.motorOff",default:"turn [MOTOR_ID] off",description:"turn a motor off"}),blockType:BlockType.COMMAND,arguments:{MOTOR_ID:{type:ArgumentType.STRING,menu:"MOTOR_ID",defaultValue:WeDo2MotorLabel.DEFAULT}}},{opcode:"startMotorPower",text:formatMessage({id:"wedo2.startMotorPower",default:"set [MOTOR_ID] power to [POWER]",description:"set the motor's power and turn it on"}),blockType:BlockType.COMMAND,arguments:{MOTOR_ID:{type:ArgumentType.STRING,menu:"MOTOR_ID",defaultValue:WeDo2MotorLabel.DEFAULT},POWER:{type:ArgumentType.NUMBER,defaultValue:100}}},{opcode:"setMotorDirection",text:formatMessage({id:"wedo2.setMotorDirection",default:"set [MOTOR_ID] direction to [MOTOR_DIRECTION]",description:"set the motor's turn direction"}),blockType:BlockType.COMMAND,arguments:{MOTOR_ID:{type:ArgumentType.STRING,menu:"MOTOR_ID",defaultValue:WeDo2MotorLabel.DEFAULT},MOTOR_DIRECTION:{type:ArgumentType.STRING,menu:"MOTOR_DIRECTION",defaultValue:WeDo2MotorDirection.FORWARD}}},{opcode:"setLightHue",text:formatMessage({id:"wedo2.setLightHue",default:"set light color to [HUE]",description:"set the LED color"}),blockType:BlockType.COMMAND,arguments:{HUE:{type:ArgumentType.NUMBER,defaultValue:50}}},{opcode:"playNoteFor",text:formatMessage({id:"wedo2.playNoteFor",default:"play note [NOTE] for [DURATION] seconds",description:"play a certain note for some time"}),blockType:BlockType.COMMAND,arguments:{NOTE:{type:ArgumentType.NUMBER,defaultValue:60},DURATION:{type:ArgumentType.NUMBER,defaultValue:.5}},hideFromPalette:!0},{opcode:"whenDistance",text:formatMessage({id:"wedo2.whenDistance",default:"when distance [OP] [REFERENCE]",description:"check for when distance is < or > than reference"}),blockType:BlockType.HAT,arguments:{OP:{type:ArgumentType.STRING,menu:"OP",defaultValue:"<"},REFERENCE:{type:ArgumentType.NUMBER,defaultValue:50}}},{opcode:"whenTilted",text:formatMessage({id:"wedo2.whenTilted",default:"when tilted [TILT_DIRECTION_ANY]",description:"check when tilted in a certain direction"}),func:"isTilted",blockType:BlockType.HAT,arguments:{TILT_DIRECTION_ANY:{type:ArgumentType.STRING,menu:"TILT_DIRECTION_ANY",defaultValue:WeDo2TiltDirection.ANY}}},{opcode:"getDistance",text:formatMessage({id:"wedo2.getDistance",default:"distance",description:"the value returned by the distance sensor"}),blockType:BlockType.REPORTER},{opcode:"isTilted",text:formatMessage({id:"wedo2.isTilted",default:"tilted [TILT_DIRECTION_ANY]?",description:"whether the tilt sensor is tilted"}),blockType:BlockType.BOOLEAN,arguments:{TILT_DIRECTION_ANY:{type:ArgumentType.STRING,menu:"TILT_DIRECTION_ANY",defaultValue:WeDo2TiltDirection.ANY}}},{opcode:"getTiltAngle",text:formatMessage({id:"wedo2.getTiltAngle",default:"tilt angle [TILT_DIRECTION]",description:"the angle returned by the tilt sensor"}),blockType:BlockType.REPORTER,arguments:{TILT_DIRECTION:{type:ArgumentType.STRING,menu:"TILT_DIRECTION",defaultValue:WeDo2TiltDirection.UP}}}],menus:{MOTOR_ID:{acceptReporters:!0,items:[{text:formatMessage({id:"wedo2.motorId.default",default:"motor",description:"label for motor element in motor menu for LEGO WeDo 2 extension"}),value:WeDo2MotorLabel.DEFAULT},{text:formatMessage({id:"wedo2.motorId.a",default:"motor A",description:"label for motor A element in motor menu for LEGO WeDo 2 extension"}),value:WeDo2MotorLabel.A},{text:formatMessage({id:"wedo2.motorId.b",default:"motor B",description:"label for motor B element in motor menu for LEGO WeDo 2 extension"}),value:WeDo2MotorLabel.B},{text:formatMessage({id:"wedo2.motorId.all",default:"all motors",description:"label for all motors element in motor menu for LEGO WeDo 2 extension"}),value:WeDo2MotorLabel.ALL}]},MOTOR_DIRECTION:{acceptReporters:!0,items:[{text:formatMessage({id:"wedo2.motorDirection.forward",default:"this way",description:"label for forward element in motor direction menu for LEGO WeDo 2 extension"}),value:WeDo2MotorDirection.FORWARD},{text:formatMessage({id:"wedo2.motorDirection.backward",default:"that way",description:"label for backward element in motor direction menu for LEGO WeDo 2 extension"}),value:WeDo2MotorDirection.BACKWARD},{text:formatMessage({id:"wedo2.motorDirection.reverse",default:"reverse",description:"label for reverse element in motor direction menu for LEGO WeDo 2 extension"}),value:WeDo2MotorDirection.REVERSE}]},TILT_DIRECTION:{acceptReporters:!0,items:[{text:formatMessage({id:"wedo2.tiltDirection.up",default:"up",description:"label for up element in tilt direction menu for LEGO WeDo 2 extension"}),value:WeDo2TiltDirection.UP},{text:formatMessage({id:"wedo2.tiltDirection.down",default:"down",description:"label for down element in tilt direction menu for LEGO WeDo 2 extension"}),value:WeDo2TiltDirection.DOWN},{text:formatMessage({id:"wedo2.tiltDirection.left",default:"left",description:"label for left element in tilt direction menu for LEGO WeDo 2 extension"}),value:WeDo2TiltDirection.LEFT},{text:formatMessage({id:"wedo2.tiltDirection.right",default:"right",description:"label for right element in tilt direction menu for LEGO WeDo 2 extension"}),value:WeDo2TiltDirection.RIGHT}]},TILT_DIRECTION_ANY:{acceptReporters:!0,items:[{text:formatMessage({id:"wedo2.tiltDirection.up",default:"up"}),value:WeDo2TiltDirection.UP},{text:formatMessage({id:"wedo2.tiltDirection.down",default:"down"}),value:WeDo2TiltDirection.DOWN},{text:formatMessage({id:"wedo2.tiltDirection.left",default:"left"}),value:WeDo2TiltDirection.LEFT},{text:formatMessage({id:"wedo2.tiltDirection.right",default:"right"}),value:WeDo2TiltDirection.RIGHT},{text:formatMessage({id:"wedo2.tiltDirection.any",default:"any",description:"label for any element in tilt direction menu for LEGO WeDo 2 extension"}),value:WeDo2TiltDirection.ANY}]},OP:{acceptReporters:!0,items:["<",">"]}}}}motorOnFor(t){let o=1e3*Cast.toNumber(t.DURATION);return o=MathUtil.clamp(o,0,15e3),new Promise(e=>{this._forEachMotor(t.MOTOR_ID,e=>{e=this._peripheral.motor(e);e&&e.turnOnFor(o)}),setTimeout(e,o)})}motorOn(e){return this._forEachMotor(e.MOTOR_ID,e=>{e=this._peripheral.motor(e);e&&e.turnOn()}),new Promise(e=>{setTimeout(()=>{e()},BLESendInterval)})}motorOff(e){return this._forEachMotor(e.MOTOR_ID,e=>{e=this._peripheral.motor(e);e&&e.turnOff()}),new Promise(e=>{setTimeout(()=>{e()},BLESendInterval)})}startMotorPower(t){return this._forEachMotor(t.MOTOR_ID,e=>{e=this._peripheral.motor(e);e&&(e.power=MathUtil.clamp(Cast.toNumber(t.POWER),0,100),e.turnOn())}),new Promise(e=>{setTimeout(()=>{e()},BLESendInterval)})}setMotorDirection(o){return this._forEachMotor(o.MOTOR_ID,e=>{var t=this._peripheral.motor(e);if(t){switch(o.MOTOR_DIRECTION){case WeDo2MotorDirection.FORWARD:t.direction=1;break;case WeDo2MotorDirection.BACKWARD:t.direction=-1;break;case WeDo2MotorDirection.REVERSE:t.direction=-t.direction;break;default:log.warn("Unknown motor direction in setMotorDirection: "+o.DIRECTION)}t.isOn&&(t.pendingTimeoutDelay?t.turnOnFor(t.pendingTimeoutStartTime+t.pendingTimeoutDelay-Date.now()):t.turnOn())}}),new Promise(e=>{setTimeout(()=>{e()},BLESendInterval)})}setLightHue(e){e=Cast.toNumber(e.HUE),e=360*MathUtil.wrapClamp(e,0,100)/100,e=Color.hsvToRgb({h:e,s:1,v:1}),e=Color.rgbToDecimal(e);return this._peripheral.setLED(e),new Promise(e=>{setTimeout(()=>{e()},BLESendInterval)})}playNoteFor(e){let o=1e3*Cast.toNumber(e.DURATION);o=MathUtil.clamp(o,0,3e3);const i=MathUtil.clamp(Cast.toNumber(e.NOTE),25,125);if(0!==o)return new Promise(e=>{var t=this._noteToTone(i);this._peripheral.playTone(t,o),setTimeout(e,o)})}whenDistance(e){switch(e.OP){case"<":return this._peripheral.distance<Cast.toNumber(e.REFERENCE);case">":return this._peripheral.distance>Cast.toNumber(e.REFERENCE);default:return log.warn("Unknown comparison operator in whenDistance: "+e.OP),!1}}whenTilted(e){return this._isTilted(e.TILT_DIRECTION_ANY)}getDistance(){return this._peripheral.distance}isTilted(e){return this._isTilted(e.TILT_DIRECTION_ANY)}getTiltAngle(e){return this._getTiltAngle(e.TILT_DIRECTION)}_isTilted(e){return e!==WeDo2TiltDirection.ANY?this._getTiltAngle(e)>=Scratch3WeDo2Blocks.TILT_THRESHOLD:this._getTiltAngle(WeDo2TiltDirection.UP)>=Scratch3WeDo2Blocks.TILT_THRESHOLD||this._getTiltAngle(WeDo2TiltDirection.DOWN)>=Scratch3WeDo2Blocks.TILT_THRESHOLD||this._getTiltAngle(WeDo2TiltDirection.LEFT)>=Scratch3WeDo2Blocks.TILT_THRESHOLD||this._getTiltAngle(WeDo2TiltDirection.RIGHT)>=Scratch3WeDo2Blocks.TILT_THRESHOLD}_getTiltAngle(e){switch(e){case WeDo2TiltDirection.UP:return 45<this._peripheral.tiltY?256-this._peripheral.tiltY:-this._peripheral.tiltY;case WeDo2TiltDirection.DOWN:return 45<this._peripheral.tiltY?this._peripheral.tiltY-256:this._peripheral.tiltY;case WeDo2TiltDirection.LEFT:return 45<this._peripheral.tiltX?256-this._peripheral.tiltX:-this._peripheral.tiltX;case WeDo2TiltDirection.RIGHT:return 45<this._peripheral.tiltX?this._peripheral.tiltX-256:this._peripheral.tiltX;default:log.warn("Unknown tilt direction in _getTiltAngle: "+e)}}_forEachMotor(e,t){let o;switch(e){case WeDo2MotorLabel.A:o=[0];break;case WeDo2MotorLabel.B:o=[1];break;case WeDo2MotorLabel.ALL:case WeDo2MotorLabel.DEFAULT:o=[0,1];break;default:log.warn("Invalid motor ID: "+e),o=[]}for(const i of o)t(i)}_noteToTone(e){return 440*Math.pow(2,(e-69)/12)}}Scratch.extensions.register(new Scratch3WeDo2Blocks),formatMessage.setup({translations:{en:{"wedo2.getDistance":"distance","wedo2.getTiltAngle":"tilt angle [TILT_DIRECTION]","wedo2.isTilted":"tilted [TILT_DIRECTION_ANY]?","wedo2.motorDirection.backward":"that way","wedo2.motorDirection.forward":"this way","wedo2.motorDirection.reverse":"reverse","wedo2.motorId.a":"motor A","wedo2.motorId.all":"all motors","wedo2.motorId.b":"motor B","wedo2.motorId.default":"motor","wedo2.motorOff":"turn [MOTOR_ID] off","wedo2.motorOn":"turn [MOTOR_ID] on","wedo2.motorOnFor":"turn [MOTOR_ID] on for [DURATION] seconds","wedo2.playNoteFor":"play note [NOTE] for [DURATION] seconds","wedo2.setLightHue":"set light color to [HUE]","wedo2.setMotorDirection":"set [MOTOR_ID] direction to [MOTOR_DIRECTION]","wedo2.startMotorPower":"set [MOTOR_ID] power to [POWER]","wedo2.tiltDirection.any":"any","wedo2.tiltDirection.down":"down","wedo2.tiltDirection.left":"left","wedo2.tiltDirection.right":"right","wedo2.tiltDirection.up":"up","wedo2.whenDistance":"when distance [OP] [REFERENCE]","wedo2.whenTilted":"when tilted [TILT_DIRECTION_ANY]"},"zh-cn":{"wedo2.getDistance":"距离","wedo2.getTiltAngle":"向[TILT_DIRECTION]倾角","wedo2.isTilted":"向[TILT_DIRECTION_ANY]倾斜？","wedo2.motorDirection.backward":"逆时针","wedo2.motorDirection.forward":"顺时针","wedo2.motorDirection.reverse":"反转","wedo2.motorId.a":"马达A","wedo2.motorId.all":"所有马达","wedo2.motorId.b":"马达B","wedo2.motorId.default":"马达","wedo2.motorOff":"关闭[MOTOR_ID]","wedo2.motorOn":"开启[MOTOR_ID]","wedo2.motorOnFor":"开启[MOTOR_ID][DURATION]秒","wedo2.playNoteFor":"演奏音符[NOTE][DURATION]秒","wedo2.setLightHue":"将灯光颜色设为[HUE]","wedo2.setMotorDirection":"将[MOTOR_ID]转向设为[MOTOR_DIRECTION]","wedo2.startMotorPower":"将[MOTOR_ID]功率设为[POWER]","wedo2.tiltDirection.any":"任意方向","wedo2.tiltDirection.down":"下","wedo2.tiltDirection.left":"左","wedo2.tiltDirection.right":"右","wedo2.tiltDirection.up":"上","wedo2.whenDistance":"当距离[OP][REFERENCE]","wedo2.whenTilted":"当向[TILT_DIRECTION_ANY]倾斜"},"zh-tw":{"wedo2.getDistance":"距離","wedo2.getTiltAngle":"傾斜角度 [TILT_DIRECTION]","wedo2.isTilted":"傾斜 [TILT_DIRECTION_ANY]？","wedo2.motorDirection.backward":"逆時針","wedo2.motorDirection.forward":"順時針","wedo2.motorDirection.reverse":"相反","wedo2.motorId.a":"馬達 A","wedo2.motorId.all":"馬達 A 與 B","wedo2.motorId.b":"馬達 B","wedo2.motorId.default":"馬達","wedo2.motorOff":"[MOTOR_ID] 停止","wedo2.motorOn":"[MOTOR_ID] 啟動","wedo2.motorOnFor":"[MOTOR_ID] 啟動 持續 [DURATION] 秒","wedo2.playNoteFor":"演奏音階 [NOTE] 持續 [DURATION] 秒","wedo2.setLightHue":"LED 顏色設為 [HUE]","wedo2.setMotorDirection":"[MOTOR_ID] 方向設為 [MOTOR_DIRECTION]","wedo2.startMotorPower":"[MOTOR_ID] 動力設為 [POWER]","wedo2.tiltDirection.any":"任何","wedo2.tiltDirection.down":"向下","wedo2.tiltDirection.left":"向左","wedo2.tiltDirection.right":"向右","wedo2.tiltDirection.up":"向上","wedo2.whenDistance":"當距離 [OP] [REFERENCE]","wedo2.whenTilted":"當傾斜 [TILT_DIRECTION_ANY]"}}});